# Vcpkg Detection

## Requirements

The Vcpkg detector searches for the following files:

- `vcpkg.spdx.json` - SPDX 2.2 format SBOM files generated by vcpkg
- `manifest-info.json` - Metadata files that map installed packages to their source manifest

You must use a version of vcpkg in your build that generates SBOM files (newer than 2022-05-05). For enhanced detection with manifest linking, use vcpkg >= 2025.02.14 and Component Detection >= v5.2.26.

## Detection strategy

The detector operates in two phases:

### Phase 1: Manifest Discovery
During the preparation phase, the detector locates `manifest-info.json` files within `vcpkg_installed` directories. These files contain the path to the source `vcpkg.json` or `vcpkg-configuration.json` manifest that describes the project's dependencies. The detector builds a mapping between the installed package location and the original manifest file.

### Phase 2: SBOM Parsing
The detector searches for `vcpkg.spdx.json` files produced by vcpkg during the install process. These files are typically found under the installed packages directory in a path like `installed/<triplet>/share/<port>/vcpkg.spdx.json`. Each vcpkg port installs a separate `vcpkg.spdx.json` file[1].

The detector parses these SPDX files to extract component information and recognizes three types of SPDX package entries:

- **Port packages** (`SPDXRef-port`): Library ports installed by vcpkg, including the port name, version, and port version
- **Binary packages** (`SPDXRef-binary`): Compiled binaries with triplet information (e.g., `x64-windows`, `x64-linux`)
- **Resource packages** (`SPDXRef-resource-*`): External resources and dependencies referenced by ports

When a `manifest-info.json` exists in the `vcpkg_installed` directory, components are attributed to the source manifest rather than the SBOM file itself. The detector checks both the preferred location (`vcpkg_installed/vcpkg/manifest-info.json`) and a fallback location (`vcpkg_installed/manifest-info.json`). This enhancement, introduced in vcpkg >= 2025.02.14, ensures accurate dependency tracking and streamlines workflows like vulnerability resolution (e.g., Dependabot).

Because this detection strategy looks for the concrete files in the installed tree, it accurately detects the precise packages used during the build and excludes packages optionally used on other platforms.

## Known limitations

The detector does not distinguish between direct dependencies and transitive dependencies. All detected components are registered as top-level dependencies without parent-child relationships.

The detector does not distinguish "development-only" dependencies that are not intended to impact the final shipping product.

The detector relies on vcpkg-generated SPDX files and does not parse `vcpkg.json` manifests directly. Projects must have run vcpkg installation to generate the required SBOM files.

[1]: https://learn.microsoft.com/vcpkg/reference/software-bill-of-materials
